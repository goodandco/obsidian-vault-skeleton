/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var wt=Object.defineProperty;var Ht=Object.getOwnPropertyDescriptor;var Yt=Object.getOwnPropertyNames;var Kt=Object.prototype.hasOwnProperty;var st=(t,e)=>()=>(t&&(e=t(t=0)),e);var Z=(t,e)=>{for(var r in e)wt(t,r,{get:e[r],enumerable:!0})},Xt=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Yt(e))!Kt.call(t,s)&&s!==r&&wt(t,s,{get:()=>e[s],enumerable:!(o=Ht(e,s))||o.enumerable});return t};var qt=t=>Xt(wt({},"__esModule",{value:!0}),t);var Q={};Z(Q,{SafeFileManager:()=>vt});var vt,tt=st(()=>{vt=class{constructor(e){this.vault=e.vault}async createBatch(e){let r=[];try{for(let o of e)o.type==="folder"?await this.ensureFolder(o.path):await this.createIfAbsent(o.path,o.data)==="created"&&r.push(o.path);return{ok:!0}}catch(o){for(let s of r.reverse())try{let n=this.vault.getAbstractFileByPath(s);n&&this.vault.delete&&await this.vault.delete(n)}catch(n){}return{ok:!1,error:o}}}async has(e){var r;try{return this.vault.getAbstractFileByPath(e)?!0:(r=this.vault.adapter)!=null&&r.exists?await this.vault.adapter.exists(e):!1}catch(o){return!1}}async ensureFolder(e){var o;if(!this.vault.getAbstractFileByPath(e))try{await this.vault.createFolder(e)}catch(s){if(s&&typeof s=="object"&&((o=s.message)!=null&&o.includes("Parent folder"))){let n=e.split("/").filter(Boolean),m="";for(let d of n)if(m=m?`${m}/${d}`:d,!this.vault.getAbstractFileByPath(m))try{await this.vault.createFolder(m)}catch(a){}}}}async createIfAbsent(e,r){if(await this.has(e))return"skipped";try{return await this.vault.create(e,r),"created"}catch(o){return await this.has(e),"skipped"}}async removeDir(e){let r=this.vault.getAbstractFileByPath(e);if(r&&this.vault)try{await this.vault.trash(r,!0),await new Promise(o=>setTimeout(o,200))}catch(o){console.warn(`removeDir: failed to trash ${e}: ${o}`)}else console.warn(`removeDir: file not found: ${e}. File: ${r==null?void 0:r.path}`)}}});var nt={};Z(nt,{sanitizeFileName:()=>xt,sanitizePath:()=>Zt});function xt(t){let e=(t!=null?t:"").trim();return Array.from(e).filter(o=>o.charCodeAt(0)>=32).join("").replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").replace(/\.+$/g,"").substring(0,200)||"untitled"}function Zt(t){return t?t.split("/").filter(Boolean).map(xt).join("/"):""}var at=st(()=>{});var St={};Z(St,{ensureValidOrThrow:()=>oe,validateProjectName:()=>ee,validateTag:()=>re});function ee(t){if(!t||!t.trim())return{ok:!1,reason:"Project name is required"};let e=t.trim();if(e.length>120)return{ok:!1,reason:"Project name too long (max 120)"};for(let r of e)if(r.charCodeAt(0)<32||r==="/"||r==="\\")return{ok:!1,reason:"Project name contains invalid characters"};return{ok:!0}}function re(t){if(!t||!t.trim())return{ok:!1,reason:"Tag is required"};let e=t.trim();return te.test(e)?{ok:!0}:{ok:!1,reason:"Tag must be 2-63 chars, start with letter/digit; may include -, _, /"}}function oe(t,e){let r=t();if(!r.ok)throw new Error(`${e}: ${r.reason}`)}var te,Ft=st(()=>{te=/^[A-Za-z0-9][A-Za-z0-9_/-]{1,62}$/});var It={};Z(It,{processTemplate:()=>se});function Ct(t){return t==null?"":String(t)}function se(t,e){if(!t||typeof t!="string")return"";let r=t;for(let[o,s]of Object.entries(e)){let n=Ct(s),m=`$_${o}`;r.includes(m)&&(r=r.split(m).join(n))}for(let[o,s]of Object.entries(e)){let n=Ct(s),m=new RegExp(`\\$\\{${ne(o)}\\}`,"g");r=r.replace(m,n)}return r}function ne(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var Nt=st(()=>{});var Gt={};Z(Gt,{CURRENT_SETTINGS_SCHEMA_VERSION:()=>le,migrateSettings:()=>de});function de(t){var s,n,m;let e={dimensions:(s=t==null?void 0:t.dimensions)!=null?s:[],projectsRoot:(n=t==null?void 0:t.projectsRoot)!=null?n:"1. Projects",schemaVersion:(m=t==null?void 0:t.schemaVersion)!=null?m:0,projectRecords:{}},r=t==null?void 0:t.projectRecords;if(r&&typeof r=="object"&&!Array.isArray(r))e.projectRecords=r;else if(Array.isArray(r)){let d={};for(let a of r){if(!a||!a.info)continue;let l=a.info.dimension,c=a.info.category,p=a.info.id;!l||!c||!p||(d[l]=d[l]||{},d[l][c]=d[l][c]||{},d[l][c][p]=a)}e.projectRecords=d}else e.projectRecords={};if(Array.isArray(e.dimensions)){let d=1;e.dimensions=e.dimensions.map(a=>{var l;if(a&&typeof a=="object"){let c=(l=a.name)!=null?l:"",p=a.order,g=typeof c=="string"?c.match(/^\s*(\d+)\.\s*(.+)$/):null;return g&&(p=parseInt(g[1],10),c=g[2]),(p==null||Number.isNaN(p))&&(p=d++),{name:c,order:p,categories:Array.isArray(a.categories)?a.categories:[]}}return{name:String(a!=null?a:""),order:d++,categories:[]}})}else e.dimensions=[];let o=[...e.dimensions].sort((d,a)=>{var l,c;return((l=d.order)!=null?l:0)-((c=a.order)!=null?c:0)});return o.forEach((d,a)=>{d.order=a+1}),e.dimensions=o,(!e.schemaVersion||e.schemaVersion<2)&&(e.schemaVersion=2),e}var le,Lt=st(()=>{le=2});var pe={};Z(pe,{default:()=>me});module.exports=qt(pe);var zt=require("obsidian");var v=require("obsidian");var $t=require("obsidian"),mt=class extends $t.Modal{constructor(r,o){super(r);this.onResult=o}onOpen(){let{contentEl:r}=this;r.empty(),r.addClass("project-flow-settings"),r.createEl("p",{text:"Do you want skip settings to defaults? This will override all custom settings."});let o=r.createDiv({cls:"gc-row"});o.createDiv({cls:"gc-spacer"});let s=o.createEl("button",{text:"Yes, use defaults"}),n=o.createEl("button",{text:"Go back"});s.onclick=()=>{this.close(),this.onResult(!0)},n.onclick=()=>{this.close(),this.onResult(!1)}}onClose(){this.contentEl.empty()}};async function pt(t,e,r,o){let s="",n=t.settings.projectRecords,m=n[e][r][o],{SafeFileManager:d}=await Promise.resolve().then(()=>(tt(),Q)),a=new d(t.app),{sanitizePath:l}=await Promise.resolve().then(()=>(at(),nt)),c=l(m.variables.PROJECT_PATH),p=l(`Templates/${m.info.name}_Templates`);try{await a.removeDir(c),await a.removeDir(p);try{n[e][r][o]&&(delete n[e][r][o],Object.keys(n[e][r]).length===0&&delete n[e][r],Object.keys(n[e]).length===0&&delete n[e]),await t.saveData(t.settings),s="Project deleted successfully."}catch(g){s="Failed to update projectRecords after delete",console.warn(s,g)}return[!0,s]}catch(g){s="Error removing project: "+g.message,console.error("Error removing project:",g)}return[!1,s]}async function gt(t,e,r,o){var s,n,m,d,a;try{let l=t.settings.projectRecords,c=(n=(s=l==null?void 0:l[e])==null?void 0:s[r])==null?void 0:n[o];if(!c)return[!1,"Project not found."];let{sanitizePath:p}=await Promise.resolve().then(()=>(at(),nt)),{SafeFileManager:g}=await Promise.resolve().then(()=>(tt(),Q)),k=new g(t.app),S=t.app.vault.adapter,f=p(c.variables.PROJECT_PATH),D=p(`Templates/${c.info.name}_Templates`),N=t.settings.archiveRoot||"4. Archive",L=c.variables.YEAR,H=c.variables.DIMENSION||c.info.dimension,z=c.info.category,i=c.info.parent&&c.info.parent.trim().length>0?c.info.parent.trim():null,b=c.info.name,x=i?`${L}.${H}.${z}.${i}.${b}`:`${L}.${H}.${z}.${b}`,P=p(`${N}/${x}`),_=u=>{let A=u.split("/").filter(Boolean);return A.pop(),A.join("/")};if(await k.ensureFolder(_(P)),!await S.exists(f))return[!1,`Project directory not found: ${f}`];if(await S.exists(P))return[!1,`Archive destination already exists: ${P}`];await S.rename(f,P);try{if(await S.exists(D)){let u=p(`${P}/Templates`);await k.ensureFolder(u);let A=p(`${u}/${c.info.name}_Templates`);if(await S.exists(A)){let V=p(`${u}/${c.info.name}_Templates_archived`);await S.rename(D,V)}else await S.rename(D,A)}}catch(u){console.warn("Archiving templates failed:",u)}try{let u=t.settings.projectRecords;(!t.settings.archivedRecords||Array.isArray(t.settings.archivedRecords))&&(t.settings.archivedRecords=t.settings.archivedRecords&&Array.isArray(t.settings.archivedRecords)?{}:t.settings.archivedRecords||{});let A=t.settings.archivedRecords;A[e]=A[e]||{},A[e][r]=A[e][r]||{},A[e][r][o]=c,(d=(m=u==null?void 0:u[e])==null?void 0:m[r])!=null&&d[o]&&(delete u[e][r][o],Object.keys(u[e][r]).length===0&&delete u[e][r],Object.keys(u[e]||{}).length===0&&delete u[e]),await t.saveData(t.settings)}catch(u){console.warn("Failed to move project record to archive in settings:",u)}return[!0,"Project archived successfully."]}catch(l){return console.error("Archive failed:",l),[!1,(a=l==null?void 0:l.message)!=null?a:"Failed to archive project."]}}var Qt=[{name:"Business",order:1,categories:["R&D","Jobs","OpenSource","Education"]},{name:"Family",order:2,categories:["Vacations","Parenting","Common"]},{name:"Friends",order:3,categories:[]},{name:"Health",order:4,categories:["Clinics","Issues","R&D"]},{name:"Personal",order:5,categories:["R&D","Languages","SelfManagement","Writing","Reading","Music","Sports"]},{name:"Residence",order:6,categories:[]}],ht={dimensions:JSON.parse(JSON.stringify(Qt)),projectsRoot:"1. Projects",archiveRoot:"4. Archive",projectRecords:{},archivedRecords:{}};function Dt(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}var ut=class extends v.PluginSettingTab{constructor(r,o){super(r,o);this.plugin=o}display(){var z;let{containerEl:r}=this;r.empty(),r.addClass("project-flow-settings");let o=r.createDiv({cls:"gc-row"});o.createDiv({cls:"gc-spacer"});let s=o.createEl("button",{cls:["gc-icon-button","clickable-icon"],attr:{"aria-label":"Reset to defaults",title:"Reset to defaults"}});try{(0,v.setIcon)(s,"rotate-ccw")}catch(i){s.setText("Reset to defaults")}s.onclick=()=>{new mt(this.app,async b=>{b&&(this.plugin.settings=JSON.parse(JSON.stringify(ht)),await this.plugin.saveSettings(),new v.Notice("Settings were reset to defaults."),this.display())}).open()},r.createEl("h2",{text:"Folders"});let n=r.createDiv({cls:"gc-column"}),m=n.createDiv({cls:"setting-item"});m.createEl("label",{text:"Projects root"});let d=m.createEl("input",{type:"text"});d.value=this.plugin.settings.projectsRoot||"1. Projects",d.placeholder="e.g. 1. Projects",d.onchange=async()=>{this.plugin.settings.projectsRoot=d.value.trim()||"1. Projects",await this.plugin.saveSettings()};let a=n.createDiv({cls:"setting-item"});a.createEl("label",{text:"Archive root"});let l=a.createEl("input",{type:"text"});l.value=this.plugin.settings.archiveRoot||"4. Archive",l.placeholder="e.g. 4. Archive",l.onchange=async()=>{this.plugin.settings.archiveRoot=l.value.trim()||"4. Archive",await this.plugin.saveSettings()},r.createEl("h2",{text:"Dimensions"}),[...this.plugin.settings.dimensions].sort((i,b)=>{var x,P;return((x=i.order)!=null?x:0)-((P=b.order)!=null?P:0)}).forEach((i,b)=>{let x=r.createDiv({cls:"dimension-setting"}),P=x.createDiv({cls:"dimension-header"});P.addClass("gc-row"),P.createSpan({text:`${i.order}. `});let _=P.createEl("b",{text:i.name});P.createDiv({cls:"gc-spacer"});let u=P.createEl("button",{cls:["gc-icon-button","clickable-icon"]});u.setAttr("aria-label","Move up"),u.setAttr("title","Move up");try{(0,v.setIcon)(u,"arrow-up")}catch(R){u.setText("Up")}u.onclick=async()=>{let h=[...this.plugin.settings.dimensions].filter(y=>{var j,w;return((j=y.order)!=null?j:0)<((w=i.order)!=null?w:0)}).sort((y,j)=>{var w,$;return((w=j.order)!=null?w:0)-(($=y.order)!=null?$:0)})[0];if(!h)return;let E=h.order;h.order=i.order,i.order=E,await this.plugin.saveSettings(),this.display()};let A=P.createEl("button",{cls:["gc-icon-button","clickable-icon"]});A.setAttr("aria-label","Move down"),A.setAttr("title","Move down");try{(0,v.setIcon)(A,"arrow-down")}catch(R){A.setText("Down")}A.onclick=async()=>{let h=[...this.plugin.settings.dimensions].filter(y=>{var j,w;return((j=y.order)!=null?j:0)>((w=i.order)!=null?w:0)}).sort((y,j)=>{var w,$;return((w=y.order)!=null?w:0)-(($=j.order)!=null?$:0)})[0];if(!h)return;let E=h.order;h.order=i.order,i.order=E,await this.plugin.saveSettings(),this.display()};let V=P.createEl("button",{cls:["gc-icon-button","clickable-icon"]});V.setAttr("aria-label",`Delete ${i.name}`),V.setAttr("title",`Delete ${i.name}`);try{(0,v.setIcon)(V,"trash")}catch(R){V.setText("Remove")}V.onclick=async()=>{let R=this.plugin.settings.dimensions.findIndex(h=>h===i);R>=0&&this.plugin.settings.dimensions.splice(R,1),await this.plugin.saveSettings(),this.display()};let C=P.createEl("button",{cls:["gc-icon-button","clickable-icon"]});C.setAttr("aria-label",`Rename ${i.name}`),C.setAttr("title",`Rename ${i.name}`);try{(0,v.setIcon)(C,"pencil")}catch(R){C.setText("Edit")}if(C.onclick=async()=>{var U;let R=i.name,h=_.parentElement;(U=_.detach)==null||U.call(_),C.style.display="none",V.style.display="none";let E=h.createEl("input",{type:"text"});E.value=R,E.addClass("gc-rename");let y=h.createDiv({cls:"gc-row"});y.createDiv({cls:"gc-spacer"});let j=y.createEl("button",{cls:["gc-icon-button","clickable-icon"]});j.setAttr("aria-label","Apply"),j.setAttr("title","Apply");try{(0,v.setIcon)(j,"check")}catch(F){j.setText("Apply")}let w=y.createEl("button",{cls:["gc-icon-button","clickable-icon"]});w.setAttr("aria-label","Discard"),w.setAttr("title","Discard");try{(0,v.setIcon)(w,"x")}catch(F){w.setText("Discard")}let $=()=>{this.display()},I=async F=>{let M=F.trim();if(!M||M===R){$();return}if(this.plugin.settings.dimensions.some(ot=>ot!==i&&ot.name===M)){new v.Notice("A dimension with this name already exists.");return}i.name=M,await this.plugin.saveSettings(),$()};j.onclick=async()=>{await I(E.value)},w.onclick=()=>$(),E.focus(),E.select(),E.onkeydown=async F=>{F.key==="Enter"&&await I(E.value),F.key==="Escape"&&$()},E.onblur=async()=>{await I(E.value)}},i.categories.length>0){let R=x.createDiv({cls:"categories-list gc-list"});i.categories.forEach((h,E)=>{var ot;let y=R.createDiv({cls:"gc-list-item gc-row"}),j=this.plugin.settings.projectRecords||{},w=i.name,$=Object.keys(((ot=j==null?void 0:j[w])==null?void 0:ot[h])||{}),I=y.createEl("b",{text:h}),U=y.createDiv({cls:"gc-id-wrap"});$.length>0&&(U.createSpan({text:" "}),$.forEach((O,lt)=>{let T=U.createSpan({cls:"gc-id-chip"});T.style.display="inline-flex",T.style.alignItems="center",T.style.gap="4px";let q=T.createSpan({cls:"gc-id-tag",text:O}),Y=Math.abs(Dt(O))%360;q.style.backgroundColor=`hsl(${Y}, 70%, 90%)`,q.style.color=`hsl(${Y}, 70%, 25%)`;let B=T.createSpan({cls:"gc-id-actions"});B.style.display="none";let J=B.createEl("button",{cls:["gc-icon-button","clickable-icon"]});J.setAttr("aria-label",`Delete ${O}`),J.setAttr("title",`Delete ${O}`);try{(0,v.setIcon)(J,"trash")}catch(K){J.setText("Del")}J.onclick=async K=>{K.stopPropagation();let[,G]=await pt(this.plugin,w,h,O);new v.Notice(G),this.display()};let W=B.createEl("button",{cls:["gc-icon-button","clickable-icon"]});W.setAttr("aria-label",`Archive ${O}`),W.setAttr("title",`Archive ${O}`);try{(0,v.setIcon)(W,"archive")}catch(K){W.setText("Arc")}W.onclick=async K=>{K.stopPropagation();let[,G]=await gt(this.plugin,w,h,O);new v.Notice(G),this.display()},T.onmouseenter=()=>{B.style.display="inline-flex"},T.onmouseleave=()=>{B.style.display="none"},lt<$.length-1&&U.createSpan({text:" "})})),y.createDiv({cls:"gc-spacer"});let F=y.createEl("button",{cls:["remove-category","gc-icon-button","clickable-icon"]});F.setAttr("aria-label",`Delete ${h}`),F.setAttr("title",`Delete ${h}`);try{(0,v.setIcon)(F,"trash")}catch(O){F.setText("Remove")}F.onclick=async()=>{i.categories.splice(E,1),await this.plugin.saveSettings(),this.display()};let M=y.createEl("button",{cls:["gc-icon-button","clickable-icon"]});M.setAttr("aria-label",`Rename ${h}`),M.setAttr("title",`Rename ${h}`);try{(0,v.setIcon)(M,"pencil")}catch(O){M.setText("Edit")}M.onclick=async()=>{var K;let O=i.categories[E],lt=I.parentElement;(K=I.detach)==null||K.call(I),M.style.display="none",F.style.display="none";let T=lt.createEl("input",{type:"text"});T.value=O,T.addClass("gc-rename");let q=lt.createDiv({cls:"gc-row"});q.createDiv({cls:"gc-spacer"});let Y=q.createEl("button",{cls:["gc-icon-button","clickable-icon"]});Y.setAttr("aria-label","Apply"),Y.setAttr("title","Apply");try{(0,v.setIcon)(Y,"check")}catch(G){Y.setText("Apply")}let B=q.createEl("button",{cls:["gc-icon-button","clickable-icon"]});B.setAttr("aria-label","Discard"),B.setAttr("title","Discard");try{(0,v.setIcon)(B,"x")}catch(G){B.setText("Discard")}let J=()=>{this.display()},W=async G=>{let dt=G.trim();if(!dt||dt===O){J();return}if(i.categories.some((Ut,Wt)=>Wt!==E&&Ut===dt)){new v.Notice("This category already exists in the dimension.");return}i.categories[E]=dt,await this.plugin.saveSettings(),J()};Y.onclick=async()=>{await W(T.value)},B.onclick=()=>J(),T.focus(),T.select(),T.onkeydown=async G=>{G.key==="Enter"&&await W(T.value),G.key==="Escape"&&J()},T.onblur=async()=>{await W(T.value)}}})}let X=x.createDiv({cls:"add-category gc-row"}),rt=X.createEl("input",{type:"text",placeholder:"New category"});X.createDiv({cls:"gc-spacer"});let Et=X.createEl("button",{text:"Add Category"});Et.onclick=async()=>{let R=rt.value.trim();R&&!i.categories.includes(R)&&(i.categories.push(R),await this.plugin.saveSettings(),this.display())}});let p=r.createDiv({cls:"add-dimension"});p.createEl("h3",{text:"Add new dimension"});let g=p.createDiv({cls:"gc-row"}),k=g.createEl("input",{type:"text",placeholder:"Dimension name"});g.createDiv({cls:"gc-spacer"});let S=g.createEl("button",{text:"Add Dimension"});S.onclick=async()=>{let i=k.value.trim();if(i&&!this.plugin.settings.dimensions.some(b=>b.name===i)){{let b=this.plugin.settings.dimensions.reduce((x,P)=>{var _;return Math.max(x,(_=P.order)!=null?_:0)},0);this.plugin.settings.dimensions.push({name:i,order:b+1,categories:[]})}await this.plugin.saveSettings(),this.display()}},r.createEl("h2",{text:"Archive"});let f=this.plugin.settings.archivedRecords||{},D=f&&!Array.isArray(f)?f:{},N={};for(let i of this.plugin.settings.dimensions)N[i.name]=(z=i.order)!=null?z:Number.MAX_SAFE_INTEGER;let L=Object.keys(D).map(i=>{var b;return{name:i,order:(b=N[i])!=null?b:Number.MAX_SAFE_INTEGER}}).sort((i,b)=>i.order-b.order||i.name.localeCompare(b.name)),H=!1;L.forEach(({name:i,order:b})=>{let x=D[i]||{},P=Object.keys(x).filter(C=>Object.keys(x[C]||{}).length>0).sort();if(P.length===0)return;H=!0;let _=r.createDiv({cls:"dimension-setting"}),u=_.createDiv({cls:"dimension-header gc-row"}),A=this.plugin.settings.dimensions.find(C=>C.name===i);A&&u.createSpan({text:`${A.order}. `}),u.createEl("b",{text:i}),u.createDiv({cls:"gc-spacer"});let V=_.createDiv({cls:"categories-list gc-list"});P.forEach(C=>{let X=V.createDiv({cls:"gc-list-item gc-row"}),rt=Object.keys((x==null?void 0:x[C])||{}).sort(),Et=X.createEl("b",{text:C}),R=X.createDiv({cls:"gc-id-wrap"});rt.length>0&&(R.createSpan({text:" "}),rt.forEach((h,E)=>{let y=R.createSpan({cls:"gc-id-chip"});y.style.display="inline-flex",y.style.alignItems="center",y.style.gap="4px";let j=y.createSpan({cls:"gc-id-tag",text:h}),w=Math.abs(Dt(h))%360;j.style.backgroundColor=`hsl(${w}, 70%, 90%)`,j.style.color=`hsl(${w}, 70%, 25%)`;let $=y.createSpan({cls:"gc-id-actions"});$.style.display="none";let I=$.createEl("button",{cls:["gc-icon-button","clickable-icon"]});I.setAttr("aria-label",`Delete ${h}`),I.setAttr("title",`Delete ${h}`);try{(0,v.setIcon)(I,"trash")}catch(U){I.setText("Del")}I.onclick=async U=>{U.stopPropagation();let[,F]=await this.plugin.deleteArchivedProject(i,C,h);new v.Notice(F),this.display()},y.onmouseenter=()=>{$.style.display="inline-flex"},y.onmouseleave=()=>{$.style.display="none"},E<rt.length-1&&R.createSpan({text:" "})})),X.createDiv({cls:"gc-spacer"})})}),H||r.createDiv({cls:"setting-item"}).createSpan({text:"No archived projects yet."})}};var bt=require("obsidian");var Tt=require("obsidian"),ft=class extends Tt.Modal{constructor(r,o,s){super(r);this.prompt=o,this.callback=s}onOpen(){let{contentEl:r}=this;r.createEl("h2",{text:this.prompt});let o=r.createEl("input",{type:"text"});o.focus();let s=r.createEl("button",{text:"Submit"});s.onclick=()=>{let n=o.value.trim();this.close(),this.callback(n||null)}}onClose(){let{contentEl:r}=this;r.empty()}};var kt=require("obsidian"),it=class extends kt.Modal{constructor(r,o,s,n){super(r);this.prompt=o,this.choices=s,this.callback=n}onOpen(){let{contentEl:r}=this;r.createEl("h2",{text:this.prompt}),this.choices.forEach(o=>{let s=r.createEl("button",{text:o});s.onclick=()=>{this.close(),this.callback(o)}})}onClose(){let{contentEl:r}=this;r.empty()}};async function ct(t,e){return new Promise(r=>{new ft(t,e,r).open()})}async function et(t,e,r){return new Promise(o=>{new it(t,e,r,o).open()})}async function _t(t,e){var k,S;let r=await ct(t,"Enter project name:");if(!r)return[null,"Project creation cancelled. No project name provided."];let o=await ct(t,"Enter project tag:");if(!o)return[null,"Project creation cancelled. No project tag provided."];let s=await ct(t,"Enter Project ID (used for task prefixes):");if(!s)return[null,"Project creation cancelled. No Project ID provided."];let n=await ct(t,"Enter parent name (optional):"),m=n&&n.trim().length>0?n.trim():null,d=[...e.dimensions].sort((f,D)=>{var N,L;return((N=f.order)!=null?N:0)-((L=D.order)!=null?L:0)}).map(f=>f.name),a=await et(t,"Select dimension:",d);if(!a)return[null,"Project creation cancelled. No dimension selected."];let l=e.dimensions.find(f=>f.name===a);if(!l||l.categories.length===0)return[null,"Selected dimension has no categories. Please add categories in settings first."];let c=l.categories,p=await et(t,"Select category:",c);if(!p)return[null,"Project creation cancelled. No category selected."];let g={name:r,tag:o,id:s,parent:m,dimension:a,category:p};try{let f=e.projectRecords;if(f&&!Array.isArray(f)&&((S=(k=f[a])==null?void 0:k[p])==null?void 0:S[s]))return[null,`Project with ID "${s}" already exists in ${a}:${p}. Choose a different ID.`]}catch(f){}try{let{validateProjectName:f,validateTag:D,ensureValidOrThrow:N}=await Promise.resolve().then(()=>(Ft(),St));N(()=>f(g.name),"Invalid project name"),N(()=>D(g.tag),"Invalid tag"),N(()=>D(g.id),"Invalid Project ID")}catch(f){let D=f.message||"Invalid input";return console.error("Validation error:",f),[null,D]}return[g,"Project details collected."]}async function yt(t,e){var c;if(!e.projectRecords)return[null,"You don't have any projects yet."];let r=e.projectRecords,o=[...e.dimensions].sort((p,g)=>{var k,S;return((k=p.order)!=null?k:0)-((S=g.order)!=null?S:0)}).map(p=>p.name),s=await et(t,"Select dimension of your project:",o);if(!s)return[null,"Project action cancelled. No dimension selected."];let n=e.dimensions.find(p=>p.name===s);if(!n||n.categories.length===0)return[null,"Selected dimension has no categories. No project found."];let m=n.categories,d=await et(t,"Select category:",m);if(!d)return[null,"Project action cancelled. No category selected."];let a=(c=r[s])==null?void 0:c[d];if(!a||Object.keys(a).length===0)return[null,"No projects found in this category."];let l=await et(t,"Select Project:",Object.keys(a));return l?[{dimension:s,category:d,projectId:l},"Project details collected."]:[null,"Project action cancelled. No project selected."]}function Ot(t,e){let r=new Date,o=r.getFullYear().toString(),s=r.toISOString().split("T")[0],n=e.projectsRoot||"1. Projects",m=t.parent&&t.parent.trim().length>0?`.${t.parent.trim()}`:"",d=`${o}${m}.${t.name}`,a=e.dimensions.find(g=>g.name===t.dimension),l=a?`${a.order}. ${a.name}`:t.dimension,c=`${n}/${l}/${t.category}/${d}`,p=`${c}`;return{PROJECT_NAME:t.name,PROJECT_TAG:t.tag,PROJECT_PARENT:t.parent?t.parent:"",PARENT_TAG:t.parent?t.tag:"",YEAR:o,DATE:s,PROJECT_FULL_NAME:d,PROJECT_RELATIVE_PATH:c,PROJECT_PATH:p,DIMENSION:a?a.name:t.dimension,CATEGORY:t.category,PROJECT_ID:t.id,PROJECT_DIMENSION:a?a.name:t.dimension}}async function jt(t,e){try{let{processTemplate:r}=await Promise.resolve().then(()=>(Nt(),It));return r(t,e)}catch(r){console.warn("Template processor import failed, using legacy replacement:",r);let o=t;return Object.entries(e).forEach(([s,n])=>{let m=`$_${s}`;o=o.split(m).join(n)}),o}}async function Mt(t,e){try{let r=Ot(e,t.settings),o=t.settings.projectsRoot||"1. Projects",{sanitizePath:s,sanitizeFileName:n}=await Promise.resolve().then(()=>(at(),nt)),{SafeFileManager:m}=await Promise.resolve().then(()=>(tt(),Q)),d=new m(t.app),a=s(o),l=t.settings.dimensions.find(i=>i.name===e.dimension),c=l?`${l.order}. ${l.name}`:e.dimension,p=n(c),g=n(e.category),k=s(`${a}/${p}/${g}/${r.PROJECT_FULL_NAME}`),f=[{type:"folder",path:k},...["Knowledge Base","Meetings","Work","Work/Tasks","People"].map(i=>({type:"folder",path:s(`${k}/${i}`)}))],D=t.app.vault.adapter,N=`.obsidian/plugins/${t.manifest.id}/src/templates`,L=[{fileName:`${r.PROJECT_FULL_NAME}.md`,template:"project.md"},{fileName:`${e.name} Meetings.md`,template:"meetings.md"},{fileName:`${e.name} People.md`,template:"people.md"},{fileName:`${e.name} Work.md`,template:"work.md"},{fileName:`${e.name} Knowledge Base.md`,template:"knowledge-base.md"}],H=[];for(let i of L){let b=`${N}/${i.template}`;if(!await D.exists(b))throw new Error(`Template file not found: ${i.template}`);let x=await D.read(b),P=await jt(x,r),_=s(`${k}/${n(i.fileName)}`);H.push({type:"file",path:_,data:P})}let z=await d.createBatch([...f,...H]);if(!("ok"in z)||!z.ok)throw new Error(`Batch creation failed: ${z.error||"unknown"}`);return await ce(t,e.name,r),await ae(t,e,r),[!0,`Project "${e.name}" created successfully!`]}catch(r){return[!1,`Error creating project: ${r}`]}}async function ae(t,e,r){try{let o={info:e,variables:r,createdAt:new Date().toISOString()},s=e.dimension,n=e.category,m=e.id;if(!t.settings.projectRecords||Array.isArray(t.settings.projectRecords)){let a={},l=Array.isArray(t.settings.projectRecords)?t.settings.projectRecords:[];for(let c of l){let p=c.info.dimension,g=c.info.category,k=c.info.id;a[p]=a[p]||{},a[p][g]=a[p][g]||{},a[p][g][k]=c}t.settings.projectRecords=a}let d=t.settings.projectRecords;if(d[s]=d[s]||{},d[s][n]=d[s][n]||{},d[s][n][m])throw new Error(`Project with id "${m}" already exists in ${s}:${n}`);d[s][n][m]=o,await t.saveData(t.settings)}catch(o){throw console.warn("Failed to record project creation:",o),o}}async function ie(t,e,r,o,s){try{let n=t.app.vault.adapter,m=`.obsidian/plugins/${t.manifest.id}/src/templates/${o}`;if(!await n.exists(m))throw new Error(`Template file not found: ${o}`);let d=await n.read(m),a=await jt(d,s),l=`${e}/${r}`,{SafeFileManager:c}=await Promise.resolve().then(()=>(tt(),Q));await new c(t.app).createIfAbsent(l,a)}catch(n){throw console.error(`Failed to create ${r}:`,n),new Error(`Failed to create ${r}: ${n}`)}}async function ce(t,e,r){let{sanitizePath:o,sanitizeFileName:s}=await Promise.resolve().then(()=>(at(),nt)),{SafeFileManager:n}=await Promise.resolve().then(()=>(tt(),Q)),m=new n(t.app),d=o(`Templates/${e}_Templates`);await m.ensureFolder(d);let a=[{source:"template-meeting-daily.md",target:`${e}_Meeting_Daily_Template.md`},{source:"template-meeting-discussion.md",target:`${e}_Meeting_Discussion_Template.md`},{source:"template-meeting-knowledge.md",target:`${e}_Meeting_Knowledge_Template.md`},{source:"template-meeting-planning.md",target:`${e}_Meeting_Planning_Template.md`},{source:"template-meeting-refinement.md",target:`${e}_Meeting_Refinement_Template.md`},{source:"template-meeting-retro.md",target:`${e}_Meeting_Retro_Template.md`},{source:"template-meeting-demo.md",target:`${e}_Meeting_Demo_Template.md`},{source:"template-sprint.md",target:`${e}_Sprint_Template.md`},{source:"template-task.md",target:`${e}_Task_Template.md`},{source:"template-idea.md",target:`${e}_Idea_Template.md`},{source:"template-knowledge-base-item.md",target:`${e}_Knowledge_Item_Template.md`}];for(let l of a)try{let c=s(l.target);await ie(t,d,c,l.source,r)}catch(c){console.warn(`Failed to create template ${l.target}: ${c}`)}}async function Bt(t){let[e,r]=await _t(t.app,t.settings);if(e===null){new bt.Notice(r);return}let[,o]=await Mt(t,e);new bt.Notice(o),console.log(o)}var Rt=require("obsidian");async function Vt(t){let[e,r]=await yt(t.app,t.settings);if(e===null){new Rt.Notice(r);return}let{dimension:o,category:s,projectId:n}=e,[,m]=await pt(t,o,s,n);new Rt.Notice(m),console.log(m)}var At=require("obsidian");async function Jt(t){let[e,r]=await yt(t.app,t.settings);if(e===null){new At.Notice(r);return}let{dimension:o,category:s,projectId:n}=e,[,m]=await gt(t,o,s,n);new At.Notice(m),console.log(m)}var Pt=class extends zt.Plugin{async onload(){console.log("ProjectFlow plugin loaded"),await this.loadSettings(),this.addSettingTab(new ut(this.app,this)),this.addCommand({id:"add-project-info",name:"Add Project Info",callback:()=>Bt(this)}),this.addCommand({id:"remove-project-by-id",name:"Remove Project",callback:()=>Vt(this)}),this.addCommand({id:"archive-project-by-id",name:"Archive Project",callback:()=>Jt(this)})}async loadSettings(){let r=await this.loadData();try{let{migrateSettings:o}=await Promise.resolve().then(()=>(Lt(),Gt));this.settings=Object.assign({},ht,o(r))}catch(o){this.settings=Object.assign({},ht,r)}}async saveSettings(){await this.saveData(this.settings)}};var me=Pt;
